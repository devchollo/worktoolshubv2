<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Generate professional OBCX callback emails with AI-powered grammar checking and content enhancement - WorkToolsHub"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://www.worktoolshub.info/assets/icon-192.png"
    />
    <meta
      name="keywords"
      content="OBCX callback email, customer service, callback scheduling, professional emails, AI email assistant"
    />
    <meta name="author" content="DevChollo" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://worktoolshub.info/obcx-callback-generator"
    />
    <meta
      property="og:title"
      content="OBCX Callback Email Generator - WorkToolsHub"
    />
    <meta
      property="og:description"
      content="Generate professional OBCX callback emails with AI-powered grammar checking and content polishing"
    />
    <meta
      property="og:image"
      content="https://worktoolshub.info/assets/og-image.jpg"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta
      property="twitter:url"
      content="https://worktoolshub.info/obcx-callback-generator"
    />
    <meta
      property="twitter:title"
      content="OBCX Callback Email Generator - WorkToolsHub"
    />
    <meta
      property="twitter:description"
      content="Generate professional OBCX callback emails with AI-powered grammar checking and content polishing"
    />
    <meta
      property="twitter:image"
      content="https://worktoolshub.info/assets/og-image.jpg"
    />

    <title>OBCX Callback Email Generator - WorkToolsHub</title>

    <link rel="preconnect" href="https://api.openai.com" />
    <link rel="preconnect" href="https://worktoolshubv2.onrender.com" />

    <!-- Styling / CSS -->
    <link rel="stylesheet" href="../styles/main.css" />
    <link rel="stylesheet" href="../styles/tools.css" />

    <style>
      .timeframe-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 0.5rem;
      }

      .timeframe-input {
        padding: 0.75rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        transition: all 0.2s ease;
        background: var(--bg-color);
        color: var(--text-primary);
      }

      .timeframe-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .timeframe-helper {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 0.5rem;
        font-style: italic;
      }

      @media (max-width: 768px) {
        .tool-header h1 {
          font-size: 2rem;
        }

        .form-grid-2,
        .timeframe-grid {
          grid-template-columns: 1fr;
        }

        .result-header {
          flex-direction: column;
          gap: 1rem;
        }
      }
    </style>

    <!-- Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "OBCX Callback Email Generator",
        "description": "Generate professional OBCX callback emails with AI-powered grammar checking and content enhancement",
        "url": "https://worktoolshub.info/obcx-callback-generator",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "publisher": {
          "@type": "Organization",
          "name": "WorkToolsHub"
        },
        "featureList": [
          "AI-powered grammar checking",
          "Professional callback scheduling",
          "OBCX case management",
          "One-click copy to clipboard"
        ]
      }
    </script>
  </head>
  <body>
    <div id="header"></div>
    <div id="bread"></div>

    <main>
      <section class="tool-container">
        <div class="tool-header">
          <h1>OBCX Callback Email Generator</h1>
          <p class="subtitle">
            Create professional OBCX callback emails with AI-powered grammar
            checking and content enhancement. Schedule callbacks efficiently
            with polished, ready-to-send emails.
          </p>
        </div>

        <div class="form-container">
          <form id="obcxForm">
            <div class="form-grid">
              <div class="form-grid-2">
                <div class="form-group required">
                  <label class="form-label" for="personnelName"
                    >OBCX Personnel Name</label
                  >
                  <input
                    type="text"
                    id="personnelName"
                    name="personnelName"
                    class="form-input"
                    required
                    placeholder="e.g., John Smith"
                    autocomplete="name"
                  />
                </div>

                <div class="form-group required">
                  <label class="form-label" for="customerName"
                    >Customer Full Name</label
                  >
                  <input
                    type="text"
                    id="customerName"
                    name="customerName"
                    class="form-input"
                    required
                    placeholder="e.g., Jane Doe"
                    autocomplete="name"
                  />
                </div>
              </div>

              <div class="form-grid-2">
                <div class="form-group required">
                  <label class="form-label" for="customerContact"
                    >Customer Contact Number</label
                  >
                  <input
                    type="tel"
                    id="customerContact"
                    name="customerContact"
                    class="form-input"
                    required
                    placeholder="e.g., +1 (555) 123-4567"
                    autocomplete="tel"
                  />
                </div>

                <div class="form-group required">
                  <label class="form-label" for="caseId"
                    >Case ID (OBCX I-Case / OC-Case or OEML Case)</label
                  >
                  <input
                    type="text"
                    id="caseId"
                    name="caseId"
                    class="form-input"
                    required
                    placeholder="e.g., OBCX-2024-001234 or OC-12345"
                    autocomplete="off"
                  />
                </div>
              </div>

              <div class="form-group required">
                <label class="form-label" for="callbackTimeframe"
                  >2-Hour Callback Timeframe</label
                >
                <div class="timeframe-grid">
                  <input
                    type="datetime-local"
                    id="callbackStart"
                    name="callbackStart"
                    class="timeframe-input"
                    required
                  />
                  <input
                    type="datetime-local"
                    id="callbackEnd"
                    name="callbackEnd"
                    class="timeframe-input"
                    required
                  />
                </div>
                <div class="timeframe-helper">
                  Select start and end time for the 2-hour callback window
                </div>
              </div>

              <div class="form-group required">
                <label class="form-label" for="briefNotes">Brief Notes</label>
                <textarea
                  id="briefNotes"
                  name="briefNotes"
                  class="form-textarea"
                  required
                  placeholder="Provide brief notes about the callback purpose, customer inquiry, or relevant context..."
                  rows="4"
                ></textarea>
              </div>
            </div>

            <button type="submit" class="generate-btn" id="generateBtn">
              <span class="btn-text">
                <span>ðŸ“ž</span>
                Generate Callback Email
              </span>
              <span class="loading-spinner">
                <div class="spinner"></div>
                Processing with AI...
              </span>
            </button>

            <div class="progress-bar" id="progressBar">
              <div class="progress-fill"></div>
            </div>

            <div class="error-message" id="errorMessage"></div>
          </form>
        </div>

        <div class="result-container" id="resultContainer">
          <div class="result-header">
            <h3 class="result-title">Generated Email</h3>
            <button class="copy-btn" id="copyBtn">Copy to Clipboard</button>
          </div>
          <div class="email-preview" id="emailPreview"></div>
        </div>
      </section>
    </main>

    <div id="footer"></div>

    <script src="../scripts/layout.js"></script>
    <script type="module" src="../scripts/main.js" defer></script>
    <script src="/auth-utils.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const toolName = "business-listing-update"; // Change this per tool
        const result = await authUtils.initToolAuth(
          toolName,
          "Update business listings",
          {
            showUserInfo: true,
            userInfoContainerId: "user-info", // Add this div to your HTML
          }
        );

        if (result.success) {
          class OBCXCallbackGenerator {
            constructor() {
              this.form = document.getElementById("obcxForm");
              this.generateBtn = document.getElementById("generateBtn");
              this.progressBar = document.getElementById("progressBar");
              this.errorMessage = document.getElementById("errorMessage");
              this.resultContainer = document.getElementById("resultContainer");
              this.emailPreview = document.getElementById("emailPreview");
              this.copyBtn = document.getElementById("copyBtn");

              this.init();
            }

            init() {
              this.bindEvents();
              this.setupFormValidation();
              this.setupTimeframeValidation();
            }

            bindEvents() {
              this.form.addEventListener("submit", (e) => this.handleSubmit(e));
              this.copyBtn.addEventListener("click", () =>
                this.copyToClipboard()
              );

              // Auto-format phone number
              document
                .getElementById("customerContact")
                .addEventListener("input", this.formatPhoneNumber);

              // Validate timeframe on change
              document
                .getElementById("callbackStart")
                .addEventListener("change", () => this.validateTimeframe());
              document
                .getElementById("callbackEnd")
                .addEventListener("change", () => this.validateTimeframe());
            }

            setupFormValidation() {
              const requiredFields = this.form.querySelectorAll("[required]");
              requiredFields.forEach((field) => {
                field.addEventListener("blur", () => this.validateField(field));
                field.addEventListener("input", () =>
                  this.clearFieldError(field)
                );
              });
            }

            setupTimeframeValidation() {
              // Set minimum datetime to now
              const now = new Date();
              const minDateTime = now.toISOString().slice(0, 16);

              document.getElementById("callbackStart").min = minDateTime;
              document.getElementById("callbackEnd").min = minDateTime;
            }

            validateTimeframe() {
              const startInput = document.getElementById("callbackStart");
              const endInput = document.getElementById("callbackEnd");

              if (startInput.value && endInput.value) {
                const startTime = new Date(startInput.value);
                const endTime = new Date(endInput.value);
                const timeDiff = (endTime - startTime) / (1000 * 60 * 60); // hours

                if (timeDiff > 2) {
                  endInput.setCustomValidity(
                    "Callback window should not exceed 2 hours"
                  );
                } else if (timeDiff <= 0) {
                  endInput.setCustomValidity(
                    "End time must be after start time"
                  );
                } else {
                  endInput.setCustomValidity("");
                }
              }
            }

            validateField(field) {
              const isValid = field.checkValidity();
              if (!isValid) {
                field.style.borderColor = "#ef4444";
                field.style.boxShadow = "0 0 0 3px rgba(239, 68, 68, 0.1)";
              }
              return isValid;
            }

            clearFieldError(field) {
              field.style.borderColor = "";
              field.style.boxShadow = "";
            }

            formatPhoneNumber(e) {
              let value = e.target.value.replace(/\D/g, "");
              if (value.length >= 10) {
                value = value.substring(0, 10);
                value = `+1 (${value.substring(0, 3)}) ${value.substring(
                  3,
                  6
                )}-${value.substring(6)}`;
              }
              e.target.value = value;
            }

            async handleSubmit(e) {
              e.preventDefault();

              if (!this.validateForm()) {
                this.showError("Please fill in all required fields correctly.");
                return;
              }

              this.setLoadingState(true);
              this.hideError();

              try {
                const formData = this.getFormData();
                const generatedEmail = await this.generateEmail(formData);
                this.showResult(generatedEmail);
              } catch (error) {
                console.error("Email generation error:", error);
                this.showError(error.message);
              } finally {
                this.setLoadingState(false);
              }
            }

            validateForm() {
              const requiredFields = this.form.querySelectorAll("[required]");
              let isValid = true;

              requiredFields.forEach((field) => {
                if (!this.validateField(field)) {
                  isValid = false;
                }
              });

              // Validate timeframe
              this.validateTimeframe();
              const endInput = document.getElementById("callbackEnd");
              if (!endInput.checkValidity()) {
                isValid = false;
              }

              return isValid;
            }

            getFormData() {
              const formData = new FormData(this.form);
              const data = {};

              for (let [key, value] of formData.entries()) {
                data[key] = value.trim();
              }

              // Format timeframe
              const startTime = new Date(data.callbackStart);
              const endTime = new Date(data.callbackEnd);

              data.formattedTimeframe = `${startTime.toLocaleDateString()} from ${startTime.toLocaleTimeString()} to ${endTime.toLocaleTimeString()}`;

              return data;
            }

            async generateEmail(formData) {
              const response = await fetch(
                "https://worktoolshubv2.onrender.com/api/email/generate-obcx-callback",
                {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(formData),
                }
              );

              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(
                  errorData.message || `HTTP error! status: ${response.status}`
                );
              }

              const result = await response.json();
              return result.email;
            }

            showResult(email) {
              this.emailPreview.textContent = email;
              this.resultContainer.classList.add("show");
              this.resultContainer.scrollIntoView({ behavior: "smooth" });
            }

            setLoadingState(loading) {
              if (loading) {
                this.generateBtn.classList.add("loading");
                this.generateBtn.disabled = true;
                this.progressBar.classList.add("show");
              } else {
                this.generateBtn.classList.remove("loading");
                this.generateBtn.disabled = false;
                this.progressBar.classList.remove("show");
              }
            }

            showError(message) {
              this.errorMessage.textContent = message;
              this.errorMessage.classList.add("show");
            }

            hideError() {
              this.errorMessage.classList.remove("show");
            }

            async copyToClipboard() {
              try {
                await navigator.clipboard.writeText(
                  this.emailPreview.textContent
                );

                const originalText = this.copyBtn.textContent;
                this.copyBtn.textContent = "Copied âœ“";
                this.copyBtn.style.background = "#059669";

                setTimeout(() => {
                  this.copyBtn.textContent = originalText;
                  this.copyBtn.style.background = "";
                }, 2000);
              } catch (error) {
                console.error("Failed to copy:", error);
                this.showError("Failed to copy to clipboard");
              }
            }
          }
          new OBCXCallbackGenerator();
        }
      });
    </script>
  </body>
</html>
